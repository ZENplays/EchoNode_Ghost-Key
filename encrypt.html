<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ghost-Key v3.5.1 - EchoNode CLI</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #08080c; color: #00d4ff; padding: 20px; line-height: 1.2; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .box { border: 1px solid #00d4ff; padding: 15px; background: #111118; box-shadow: 0 0 10px #00d4ff22; display: flex; flex-direction: column; }
        textarea { width: 100%; height: 300px; background: #000; color: #00ff88; border: 1px solid #222; padding: 10px; box-sizing: border-box; font-size: 0.8rem; flex-grow: 1; outline: none; }
        textarea:focus { border-color: #00d4ff; }
        
        .controls { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        
        button { 
            background: #00d4ff; 
            color: #000; 
            border: none; 
            padding: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            text-transform: uppercase; 
            transition: all 0.1s;
        }
        
        button:hover { background: #fff; }
        button:active { transform: translateY(1px); }
        
        .btn-secondary { background: #1a1a1a; color: #00d4ff; border: 1px solid #00d4ff; font-size: 0.75rem; padding: 8px; }
        
        #transcript { margin-top: 20px; height: 120px; overflow-y: auto; border: 1px solid #333; background: #000; padding: 15px; font-size: 0.85rem; color: #00ff88; }
        .log-entry { margin-bottom: 8px; border-left: 3px solid #00d4ff; padding-left: 10px; word-break: break-all; }
        label { font-size: 0.7rem; color: #555; text-transform: uppercase; letter-spacing: 1px; }
        h2 { font-size: 0.9rem; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="box" style="margin-bottom: 20px; border-color: #333;">
        <div>
            <label>CORE_SIGNATURE: </label>
            <input type="text" id="anchorKey" value="!#BSOD#!" style="background:#000; color:#00d4ff; border:1px solid #333; padding:2px; font-family:inherit;">
            <label style="margin-left:20px;">DUMP_ENTROPY: RANDOMIZED_HEX</label>
        </div>
    </div>

    <div class="grid">
        <div class="box">
            <h2>Outbound: EchoNode Encoder</h2>
            <textarea id="plainInput" placeholder="Input raw telemetry data..."></textarea>
            <div class="controls">
                <button onclick="runGhostEncrypt()">Generate Encrypted Log</button>
                <button class="btn-secondary" onclick="exportToFile()">Export as .log file</button>
            </div>
        </div>

        <div class="box" style="border-color: #00ff88;">
            <h2 style="color: #00ff88;">Inbound: Analyze Debug Data</h2>
            <textarea id="cipherOutput" placeholder="Paste log content or import..."></textarea>
            <div class="controls">
                <button style="background:#00ff88;" onclick="runGhostDecrypt()">Decode Memory Stream</button>
                <input type="file" id="fileInput" style="display:none;" onchange="importFromFile(this)">
                <button class="btn-secondary" style="color:#00ff88; border-color:#00ff88;" onclick="document.getElementById('fileInput').click()">Import .log file</button>
            </div>
        </div>
    </div>

    <div id="transcript">
        <div class="log-entry">EchoNode Subsystem [v3.5.1] Online. Waiting for I/O...</div>
    </div>

<script>
const charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.,!?@#$%^&*()-_=+[]{} ";
const morseMap = {'1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.','0':'-----','/':'-..-.'};
const revMorse = Object.fromEntries(Object.entries(morseMap).map(([k,v])=>[v,k]));
const noisePool = "0123456789ABCDEFHIJKLMNOPQRSTUVWXYZ!@#$%^&*";
const TERMINATOR = "%1O0X!";

function addLog(sender, text) {
    const log = document.getElementById('transcript');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    const strong = document.createElement('strong');
    strong.textContent = sender.toUpperCase() + ": ";
    entry.appendChild(strong);
    entry.appendChild(document.createTextNode(text));
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

function runGhostEncrypt() {
    let input = document.getElementById('plainInput').value.toUpperCase();
    if(!input) return;
    let anchor = document.getElementById('anchorKey').value;
    let secretKey = "";
    for(let i=0; i<10; i++) secretKey += (Math.floor(Math.random() * 4) + 1);

    let rawMorseData = "";
    for (let char of input) {
        let index = charset.indexOf(char);
        if (index === -1) continue;
        let coords = (Math.floor(index / 8) + 1).toString() + ((index % 8) + 1).toString() + "/";
        for (let c of coords) { rawMorseData += morseMap[c]; }
    }

    let body = "";
    let keyIdx = 0;
    for (let bit of rawMorseData) {
        let junkCount = parseInt(secretKey[keyIdx % secretKey.length]);
        for (let i = 0; i < junkCount; i++) {
            body += noisePool[Math.floor(Math.random() * noisePool.length)];
        }
        if (bit === ".") body += Math.floor(Math.random() * 10);
        else body += noisePool[10 + Math.floor(Math.random() * (noisePool.length - 10))];
        keyIdx++;
    }

    body += TERMINATOR;
    let autoJunk = Math.floor(Math.random() * 1001);
    for(let i=0; i < autoJunk; i++) {
        body += noisePool[Math.floor(Math.random() * noisePool.length)];
    }

    const audioProcs = ["Oscillator.vst3", "ReverbUnit.dll", "EchoNode_Core.exe", "FilterBank.sys", "WaveParser.dll"];
    let randProc = audioProcs[Math.floor(Math.random()*audioProcs.length)];
    let fullPayload = anchor + secretKey + body;
    let formattedPayload = fullPayload.match(/.{1,55}/g).join('\n');

    let crashReport = `--- ECHO-NODE CRITICAL DUMP --- \n`;
    crashReport += `MODULE: ${randProc} | TS: ${new Date().toISOString()}\n`;
    crashReport += `------------------------------------------------------\n`;
    crashReport += `${formattedPayload}\n`;
    crashReport += `------------------------------------------------------\n`;
    crashReport += `STREAMS_CAPTURED: 1 | STATUS: DUMP_COMPLETE`;

    document.getElementById('cipherOutput').value = crashReport;
    addLog('system', `Encoded with ${autoJunk} chars of entropy.`);
    document.getElementById('plainInput').value = "";
}

function runGhostDecrypt() {
    let wall = document.getElementById('cipherOutput').value;
    let anchor = document.getElementById('anchorKey').value;
    let cleanWall = wall.replace(/\s/g, '');
    let anchorPos = cleanWall.indexOf(anchor);
    if (anchorPos === -1) { addLog('system', 'ERROR: ANCHOR NOT FOUND.'); return; }

    let key = cleanWall.substring(anchorPos + anchor.length, anchorPos + anchor.length + 10);
    let body = cleanWall.substring(anchorPos + anchor.length + 10);
    if(body.indexOf(TERMINATOR) !== -1) body = body.substring(0, body.indexOf(TERMINATOR));

    let extractedMorse = "";
    let keyIdx = 0, cursor = 0;
    while (cursor < body.length) {
        cursor += parseInt(key[keyIdx % key.length]);
        if (cursor >= body.length) break;
        let char = body[cursor];
        extractedMorse += (char >= '0' && char <= '9') ? "." : "-";
        cursor++; keyIdx++;
    }

    let coords = "";
    for (let i = 0; i < extractedMorse.length; i += 5) {
        let chunk = extractedMorse.substring(i, i + 5);
        coords += revMorse[chunk] || "";
    }

    let finalMsg = "";
    let coordPairs = coords.split("/");
    coordPairs.forEach(pair => {
        if (pair.length < 2) return;
        let r = parseInt(pair[0]) - 1, c = parseInt(pair[1]) - 1;
        finalMsg += charset[(r * 8) + c] || "";
    });

    if(finalMsg) {
        addLog('remote', finalMsg);
        document.getElementById('plainInput').value = finalMsg;
    } else { addLog('system', 'RECONSTRUCTION FAILED.'); }
}

function exportToFile() {
    let text = document.getElementById('cipherOutput').value;
    if(!text) return;
    let blob = new Blob([text], {type: "text/plain"});
    let anchor = document.createElement("a");
    anchor.download = `debug_log_${Math.floor(Date.now()/1000)}.log`;
    anchor.href = window.URL.createObjectURL(blob);
    anchor.click();
    addLog('system', 'Log saved to disk.');
}

function importFromFile(input) {
    let file = input.files[0];
    let reader = new FileReader();
    reader.onload = function() {
        document.getElementById('cipherOutput').value = reader.result;
        addLog('system', `Imported ${file.name}`);
        runGhostDecrypt();
    };
    reader.readAsText(file);
}
</script>
</body>
</html>
